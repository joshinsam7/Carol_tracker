{"ast":null,"code":"var _s = $RefreshSig$();\n/* eslint-disable max-len */\n/* eslint-disable require-jsdoc */\n// src/hooks/useBusWebSocket.js\nimport { useEffect, useState, useRef } from \"react\";\nexport default function useBusSocket(socketUrl) {\n  _s();\n  const [data, setData] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const wsRef = useRef(null);\n  const retryRef = useRef(0);\n  useEffect(() => {\n    if (!socketUrl) {\n      console.warn(\"WebSocket URL is undefined\");\n      return () => {};\n    }\n    const connect = () => {\n      console.log(`ðŸ”Œ Attempting WS connection to: ${socketUrl}`);\n      const ws = new WebSocket(socketUrl);\n      wsRef.current = ws;\n      ws.onopen = () => {\n        console.log(\"âœ… Connected to WebSocket server\");\n        setConnected(true);\n        retryRef.current = 0;\n      };\n      ws.onmessage = event => {\n        try {\n          const parsed = JSON.parse(event.data);\n          setData(parsed);\n        } catch (err) {\n          console.error(\"Failed to parse WS message:\", err);\n        }\n      };\n      ws.onclose = () => {\n        console.log(\"âŒ WebSocket disconnected\");\n        setConnected(false);\n        const delay = Math.min(1000 * 2 ** retryRef.current, 10000);\n        console.log(`Retrying WS in ${delay / 1000}s`);\n        retryRef.current += 1;\n        setTimeout(connect, delay);\n      };\n      ws.onerror = err => {\n        console.error(\"WebSocket error:\", err);\n        ws.close();\n      };\n    };\n    connect();\n    return () => {\n      var _wsRef$current;\n      return (_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.close();\n    }; // âœ… consistent cleanup\n  }, [socketUrl]);\n  return {\n    data,\n    connected\n  };\n}\n_s(useBusSocket, \"GjFhMA6kGPjQj56UYCuInAvnjxc=\");","map":{"version":3,"names":["useEffect","useState","useRef","useBusSocket","socketUrl","_s","data","setData","connected","setConnected","wsRef","retryRef","console","warn","connect","log","ws","WebSocket","current","onopen","onmessage","event","parsed","JSON","parse","err","error","onclose","delay","Math","min","setTimeout","onerror","close","_wsRef$current"],"sources":["/Users/joshinsam/Projects/webapps/carol-tracker/frontend/src/hooks/useBusSocket.js"],"sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable require-jsdoc */\n// src/hooks/useBusWebSocket.js\nimport {useEffect, useState, useRef} from \"react\";\n\nexport default function useBusSocket(socketUrl) {\n  const [data, setData] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const wsRef = useRef(null);\n  const retryRef = useRef(0);\n\n  useEffect(() => {\n    if (!socketUrl) {\n      console.warn(\"WebSocket URL is undefined\");\n      return () => {};\n    }\n\n    const connect = () => {\n      console.log(`ðŸ”Œ Attempting WS connection to: ${socketUrl}`);\n      const ws = new WebSocket(socketUrl);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        console.log(\"âœ… Connected to WebSocket server\");\n        setConnected(true);\n        retryRef.current = 0;\n      };\n\n      ws.onmessage = (event) => {\n        try {\n          const parsed = JSON.parse(event.data);\n          setData(parsed);\n        } catch (err) {\n          console.error(\"Failed to parse WS message:\", err);\n        }\n      };\n\n      ws.onclose = () => {\n        console.log(\"âŒ WebSocket disconnected\");\n        setConnected(false);\n        const delay = Math.min(1000 * 2 ** retryRef.current, 10000);\n        console.log(`Retrying WS in ${delay / 1000}s`);\n        retryRef.current += 1;\n        setTimeout(connect, delay);\n      };\n\n      ws.onerror = (err) => {\n        console.error(\"WebSocket error:\", err);\n        ws.close();\n      };\n    };\n\n    connect();\n\n    return () => wsRef.current?.close(); // âœ… consistent cleanup\n  }, [socketUrl]);\n\n\n  return {data, connected};\n}\n"],"mappings":";AAAA;AACA;AACA;AACA,SAAQA,SAAS,EAAEC,QAAQ,EAAEC,MAAM,QAAO,OAAO;AAEjD,eAAe,SAASC,YAAYA,CAACC,SAAS,EAAE;EAAAC,EAAA;EAC9C,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAGN,QAAQ,CAAC,IAAI,CAAC;EACtC,MAAM,CAACO,SAAS,EAAEC,YAAY,CAAC,GAAGR,QAAQ,CAAC,KAAK,CAAC;EACjD,MAAMS,KAAK,GAAGR,MAAM,CAAC,IAAI,CAAC;EAC1B,MAAMS,QAAQ,GAAGT,MAAM,CAAC,CAAC,CAAC;EAE1BF,SAAS,CAAC,MAAM;IACd,IAAI,CAACI,SAAS,EAAE;MACdQ,OAAO,CAACC,IAAI,CAAC,4BAA4B,CAAC;MAC1C,OAAO,MAAM,CAAC,CAAC;IACjB;IAEA,MAAMC,OAAO,GAAGA,CAAA,KAAM;MACpBF,OAAO,CAACG,GAAG,CAAC,mCAAmCX,SAAS,EAAE,CAAC;MAC3D,MAAMY,EAAE,GAAG,IAAIC,SAAS,CAACb,SAAS,CAAC;MACnCM,KAAK,CAACQ,OAAO,GAAGF,EAAE;MAElBA,EAAE,CAACG,MAAM,GAAG,MAAM;QAChBP,OAAO,CAACG,GAAG,CAAC,iCAAiC,CAAC;QAC9CN,YAAY,CAAC,IAAI,CAAC;QAClBE,QAAQ,CAACO,OAAO,GAAG,CAAC;MACtB,CAAC;MAEDF,EAAE,CAACI,SAAS,GAAIC,KAAK,IAAK;QACxB,IAAI;UACF,MAAMC,MAAM,GAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACf,IAAI,CAAC;UACrCC,OAAO,CAACe,MAAM,CAAC;QACjB,CAAC,CAAC,OAAOG,GAAG,EAAE;UACZb,OAAO,CAACc,KAAK,CAAC,6BAA6B,EAAED,GAAG,CAAC;QACnD;MACF,CAAC;MAEDT,EAAE,CAACW,OAAO,GAAG,MAAM;QACjBf,OAAO,CAACG,GAAG,CAAC,0BAA0B,CAAC;QACvCN,YAAY,CAAC,KAAK,CAAC;QACnB,MAAMmB,KAAK,GAAGC,IAAI,CAACC,GAAG,CAAC,IAAI,GAAG,CAAC,IAAInB,QAAQ,CAACO,OAAO,EAAE,KAAK,CAAC;QAC3DN,OAAO,CAACG,GAAG,CAAC,kBAAkBa,KAAK,GAAG,IAAI,GAAG,CAAC;QAC9CjB,QAAQ,CAACO,OAAO,IAAI,CAAC;QACrBa,UAAU,CAACjB,OAAO,EAAEc,KAAK,CAAC;MAC5B,CAAC;MAEDZ,EAAE,CAACgB,OAAO,GAAIP,GAAG,IAAK;QACpBb,OAAO,CAACc,KAAK,CAAC,kBAAkB,EAAED,GAAG,CAAC;QACtCT,EAAE,CAACiB,KAAK,CAAC,CAAC;MACZ,CAAC;IACH,CAAC;IAEDnB,OAAO,CAAC,CAAC;IAET,OAAO;MAAA,IAAAoB,cAAA;MAAA,QAAAA,cAAA,GAAMxB,KAAK,CAACQ,OAAO,cAAAgB,cAAA,uBAAbA,cAAA,CAAeD,KAAK,CAAC,CAAC;IAAA,EAAC,CAAC;EACvC,CAAC,EAAE,CAAC7B,SAAS,CAAC,CAAC;EAGf,OAAO;IAACE,IAAI;IAAEE;EAAS,CAAC;AAC1B;AAACH,EAAA,CAtDuBF,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}